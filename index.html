<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sederhana Kiosk - 1080x1920 Portrait</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        @media print {
            @page {
                size: 58mm auto;
                margin: 0;
            }
            /* Hide everything by default */
            body * {
                display: none !important;
            }
            /* Show only the printable area and its ancestors (as containers) */
            body, .kiosk-canvas, #step-5, #printable-area, #printable-area * {
                display: block !important;
                visibility: visible !important;
            }
            .kiosk-canvas, #step-5 {
                position: static !important;
                width: 100% !important;
                height: auto !important;
                padding: 0 !important;
                margin: 0 !important;
                background: white !important;
                box-shadow: none !important;
                overflow: visible !important;
            }
            #printable-area {
                width: 55mm !important; /* Adjusted for 55mm Business Card compatibility */
                max-width: 55mm !important;
                padding: 1mm !important;
                margin: 0 auto !important;
                border: none !important;
                box-shadow: none !important;
                font-family: 'Courier New', Courier, monospace !important;
                color: black !important;
                text-align: left !important;
                display: flex !important;
                flex-direction: column !important;
            }
            /* Header styles */
            #printable-area .logo-container { text-align: center !important; margin-bottom: 2mm !important; }
            #printable-area .logo-container img { width: 30mm !important; filter: grayscale(100%) !important; }
            #printable-area h1 { font-size: 12pt !important; text-align: center !important; font-weight: bold !important; margin: 0 !important; line-height: 1.2 !important; }
            #printable-area .outlet-info { font-size: 7pt !important; text-align: center !important; margin-bottom: 3mm !important; line-height: 1.1 !important; }
            
            /* Order Info styles */
            #printable-area .order-meta { font-size: 8pt !important; margin-bottom: 3mm !important; }
            #printable-area .order-meta div { display: flex !important; justify-content: space-between !important; }
            
            /* Queue Number style (Big) */
            #printable-area .queue-section { text-align: center !important; border-top: 1pt dashed black !important; border-bottom: 1pt dashed black !important; padding: 2mm 0 !important; margin: 2mm 0 !important; }
            #printable-area .queue-label { font-size: 10pt !important; font-weight: bold !important; }
            #printable-area h3 { font-size: 28pt !important; text-align: center !important; font-weight: 900 !important; margin: 1mm 0 !important; line-height: 1 !important; }
            
            /* Item list styles */
            #receipt-items { width: 100% !important; margin-bottom: 2mm !important; }
            #receipt-items .item-row { font-size: 8pt !important; margin-bottom: 1mm !important; display: flex !important; flex-direction: column !important; }
            #receipt-items .item-main { display: flex !important; justify-content: space-between !important; font-weight: bold !important; }
            #receipt-items .item-sub { display: flex !important; justify-content: flex-start !important; font-size: 7pt !important; color: #555 !important; }
            
            /* Total styles */
            .total-section { border-top: 1pt dashed black !important; padding-top: 2mm !important; margin-top: 2mm !important; }
            .total-row { display: flex !important; justify-content: space-between !important; font-size: 9pt !important; font-weight: bold !important; margin-bottom: 0.5mm !important; }
            .total-amount { font-size: 11pt !important; border-top: 1pt solid black !important; margin-top: 1mm !important; padding-top: 1mm !important; }

            /* Footer */
            #printable-area .footer-msg { text-align: center !important; font-size: 7pt !important; font-style: italic !important; margin-top: 4mm !important; line-height: 1.2 !important; }
            
            .no-print { display: none !important; }
            .flex { display: flex !important; justify-content: space-between !important; }
        }

        :root {
            --canvas-width: 100vw;
            --canvas-height: 100vh;
            --sidebar-width: clamp(200px, 20vw, 280px);
            --primary-red: #dc2626;
        }

        html {
            /* Logic scaling responsif global */
            font-size: clamp(12px, 1.2vw, 20px);
        }

        @media (max-width: 768px) {
            html { font-size: clamp(10px, 2.5vw, 16px); }
        }

        @media (max-width: 480px) {
            html { font-size: clamp(8px, 3.5vw, 14px); }
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: radial-gradient(circle at center, #2c2c2c 0%, #121212 100%); 
            display: flex; 
            justify-content: center; 
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden;
        }

        /* Container Kiosk Utama */
        .kiosk-canvas {
            background-color: #ffffff;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 100px rgba(0,0,0,0.8);
            width: 100vw;
            height: 100vh;
            transition: all 0.3s ease;
        }

        /* =========================================
           MODE PORTRAIT (DEFAULT) - Fix & Lock
           ========================================= */
        @media (orientation: portrait) {
            .kiosk-canvas {
                max-width: 100vw;
                margin: auto;
            }
            
            #step-3 .flex-1.flex { flex-direction: column !important; }
            #step-3 .w-\[280px\] { 
                width: 100% !important; 
                padding: 0.5rem !important; 
                display: flex !important; 
                flex-direction: row !important; 
                overflow-x: auto !important; 
                gap: 0.5rem !important;
                border-bottom: 1px solid #f3f4f6;
                background: white;
                z-index: 10;
                scrollbar-width: none;
            }
            #step-3 .category-btn { 
                flex: 0 0 auto !important; 
                padding: 0.75rem 1rem !important;
                font-size: 1rem !important;
            }
            
            #menu-container { 
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem !important;
                padding: 1rem !important;
            }

            #cart-details { bottom: 6rem !important; width: 100% !important; left: 0 !important; right: auto !important; border-radius: 1.5rem 1.5rem 0 0 !important; }

            /* Step 4: Payment Selection (Portrait) */
            #step-4 .bg-white {
                width: 94% !important;
                max-width: 500px !important;
                min-height: auto !important;
                max-height: 90vh !important;
                padding: 1.5rem 1rem !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: flex-start !important;
                border-radius: 2rem !important;
            }
            #payment-selection { 
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important; 
                margin-top: 0.5rem !important;
                margin-bottom: 0.5rem !important;
            }
            #payment-selection button { 
                padding: 1rem 0.5rem !important; 
                min-height: 80px !important;
                border-radius: 1.5rem !important;
                flex-direction: column !important;
            }
            #payment-selection .text-8xl { font-size: 2.5rem !important; }
            #payment-selection .text-3xl { font-size: 1rem !important; }
            
            #step-4 h2 { font-size: 1.5rem !important; margin-bottom: 1rem !important; }
            #step-4 .flex.justify-between.mb-12.px-10 {
                flex-direction: column !important;
                gap: 0.25rem !important;
                margin-bottom: 0.75rem !important;
                padding: 0 !important;
                align-items: center !important;
            }
            #step-4 .text-3xl.text-gray-500 { font-size: 1rem !important; }
            #final-total { font-size: 2rem !important; line-height: 1.2 !important; }
            
            #qris-container { padding: 0.75rem !important; margin-bottom: 0.75rem !important; border-radius: 1.5rem !important; }
            #qris-qr-wrapper { padding: 0.5rem !important; margin-bottom: 0.5rem !important; border-radius: 1rem !important; }
            #qris-image { width: 8rem !important; }
            #qris-container p { font-size: 0.875rem !important; margin-bottom: 0.25rem !important; }
            #payment-timer { font-size: 0.875rem !important; }
            
            #step-4 button[onclick="nextStep(3)"] { 
                font-size: 1rem !important; 
                padding: 0.5rem 1rem !important;
                margin-top: 0.5rem !important;
                border-radius: 0.75rem !important;
            }

            /* Step 5: Receipt (Portrait) */
            #step-5 { 
                justify-content: flex-start !important; 
                padding: 1rem !important;
                overflow-y: auto !important; 
            }
            #step-5 .no-print:first-child .w-64 { 
                width: 4rem !important; 
                height: 4rem !important; 
                font-size: 2rem !important; 
                margin-bottom: 0.5rem !important;
            }
            #step-5 .no-print:first-child h2 { font-size: 1.5rem !important; margin-bottom: 0.25rem !important; }
            #step-5 .no-print:first-child p { font-size: 0.875rem !important; margin-bottom: 0.5rem !important; }
            
            #step-5 #printable-area {
                margin: 0.25rem auto !important;
                width: 100% !important;
                padding: 0.75rem !important;
                border-radius: 1rem !important;
            }
            #queue-number { font-size: 3rem !important; }
            
            #step-5 .flex.gap-6.mt-12.no-print {
                margin-top: 1rem !important;
                margin-bottom: 2rem !important;
                gap: 0.5rem !important;
            }
            #step-5 .flex.gap-6.mt-12.no-print button { 
                padding: 0.5rem 1rem !important; 
                font-size: 1rem !important;
                border-radius: 1.5rem !important;
            }
        }

        /* =========================================
           MODE LANDSCAPE (AUTO DETECT & RESPONSIVE)
           ========================================= */
        @media (orientation: landscape) {
            .kiosk-canvas {
                max-width: 100% !important;
                width: 100vw !important;
            }

            /* Sidebar Navigasi Kiri */
            #step-3 .flex-1.flex { flex-direction: row !important; }
            #step-3 .w-\[280px\] { 
                width: var(--sidebar-width) !important; 
                height: 100% !important;
                padding: 1.5rem !important; 
                display: flex !important; 
                flex-direction: column !important; 
                overflow-y: auto !important; 
                overflow-x: hidden !important;
                gap: 1rem !important;
                border-right: 2px solid #f3f4f6;
                border-bottom: none !important;
                background: #f9fafb;
                z-index: 10;
            }
            #step-3 .category-btn { 
                width: 100% !important; 
                justify-content: flex-start !important;
                padding: 1.2rem !important;
                flex: 0 0 auto !important;
                flex-direction: row !important;
            }

            /* Grid Menu Responsive */
            #menu-container { 
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
                padding: 2rem !important;
                gap: 1.5rem !important;
                align-content: start;
                padding-bottom: 10rem !important;
            }

            /* Cart Details - Floating Right or Bottom Right */
            #cart-details { 
                bottom: 120px !important; 
                left: auto !important; 
                right: 1.5rem !important; 
                width: 45% !important;
                max-height: 50vh !important;
                border-radius: 2.5rem !important;
                box-shadow: 0 15px 50px rgba(0,0,0,0.25) !important;
            }

            /* Step 1 & 2 Layout */
            #step-1, #step-2 { padding: 5rem !important; }
            #step-2 .flex-col { flex-direction: row !important; flex-wrap: wrap; justify-content: center; gap: 3rem !important; }
            #step-2 .bg-white { width: 400px !important; }

            /* Step 4: Payment (Landscape) - Fix Overlap */
            #step-4 .bg-white {
                width: 90% !important;
                max-width: 800px !important;
                max-height: 95vh !important;
                padding: 1.5rem !important;
                display: grid !important;
                grid-template-columns: 1fr 1.2fr !important;
                gap: 1.5rem !important;
                align-items: start !important;
                border-radius: 2rem !important;
            }
            #step-4 h2 { grid-column: span 2 !important; font-size: 1.5rem !important; margin-bottom: 0.5rem !important; }
            #payment-selection { 
                grid-column: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
                margin: 0 !important;
            }
            #payment-selection button { 
                min-height: 60px !important; 
                padding: 0.75rem !important; 
                flex-direction: row !important;
                gap: 1rem !important;
            }
            #payment-selection .text-8xl { font-size: 2rem !important; }
            #payment-selection .text-3xl { font-size: 1rem !important; }

            .payment-summary-wrapper {
                grid-column: 2 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
            }
            #step-4 .flex.justify-between.mb-12.px-10 {
                margin: 0 !important;
                padding: 0 !important;
                flex-direction: row !important;
                justify-content: space-between !important;
                align-items: center !important;
            }
            #step-4 .text-3xl.text-gray-500 { font-size: 1rem !important; }
            #final-total { font-size: 1.75rem !important; }

            #qris-container, #card-container { 
                margin: 0 !important; 
                padding: 0.75rem !important; 
                border-radius: 1.5rem !important;
            }
            #qris-image { width: 7rem !important; }
            #qris-qr-wrapper { margin-bottom: 0.5rem !important; padding: 0.5rem !important; }
            #qris-container p { font-size: 0.875rem !important; }
            
            #step-4 button[onclick="nextStep(3)"] { 
                grid-column: span 2 !important;
                width: auto !important;
                margin: 0 auto !important;
                padding: 0.5rem 1.5rem !important;
                font-size: 1rem !important;
            }

            /* Step 5 (Bill Result) Landscape */
            #step-5 { 
                flex-direction: row !important; 
                padding: 2rem !important; 
                gap: 2rem !important;
                align-items: center !important;
                justify-content: center !important;
            }
            #step-5 .no-print:first-child { 
                flex: 1 !important; 
                margin-bottom: 0 !important;
                height: 100% !important;
                justify-content: center !important;
            }
            #step-5 .no-print:first-child .w-64 { width: 12rem !important; height: 12rem !important; text-size-adjust: auto; }
            #step-5 .no-print:first-child h2 { font-size: 3rem !important; }
            #step-5 .no-print:first-child p { font-size: 1.5rem !important; }

            #step-5 #printable-area { 
                flex: 1.2 !important; 
                max-width: 500px !important; 
                margin: 0 !important; 
                transform: scale(0.85) !important;
                max-height: 95vh !important;
                overflow-y: auto !important;
            }

            #step-5 .flex.gap-6.mt-12.no-print { 
                flex: 1 !important; 
                flex-direction: column !important; 
                margin-top: 0 !important;
                gap: 2rem !important;
                height: 100% !important;
                justify-content: center !important;
            }
            #step-5 .flex.gap-6.mt-12.no-print button { width: 100% !important; padding: 2rem !important; }
        }

        /* =========================================
           DUKUNGAN RESOLUSI KHUSUS
           ========================================= */
        
        /* Smartphone Khusus (1080x2400 - 1080x2436) */
        @media (max-width: 1100px) and (min-height: 2200px) {
            html { font-size: clamp(14px, 4vw, 24px); }
            #step-4 .bg-white { width: 95% !important; padding: 2.5rem 1.5rem !important; }
            #final-total { font-size: 3rem !important; }
            #qris-image { width: 12rem !important; }
        }
            #qris-qr-wrapper { 
                padding: 0.8rem !important; 
                margin-bottom: 1rem !important; 
            }
            #qris-image { width: 12rem !important; }
            #qris-container p { font-size: 1.2rem !important; margin-bottom: 0.5rem !important; }
            
            #step-4 button[onclick="nextStep(3)"] { 
                margin-top: 0.5rem !important; 
                padding: 1rem 2rem !important; 
                font-size: 1.5rem !important; 
            }
            #step-5 { flex-direction: row !important; align-items: center !important; padding: 1rem !important; }
            #step-5 .no-print:first-child { flex: 0.8 !important; }
            #step-5 #printable-area { transform: scale(0.7) !important; flex: 1 !important; }
            #step-5 .flex.gap-6.mt-12.no-print { flex: 0.8 !important; }
        }

        /* Smartphone Small */
        @media (max-width: 640px) {
            html { font-size: 14px; }
            .p-20 { padding: 1.5rem !important; }
            #menu-container { grid-template-columns: repeat(2, 1fr) !important; }
        }

        /* Penyesuaian Font Global */
        html {
            font-size: clamp(12px, 1.5vh, 20px);
        }

        /* Override Utility Classes */
        .p-20 { padding: 2rem !important; }
        .mb-20 { margin-bottom: 2.5rem !important; }
        .mb-32 { margin-bottom: 4rem !important; }
        .mb-24 { margin-bottom: 3rem !important; }
        
        .w-80 { width: 14rem !important; }
        .w-48 { width: 8rem !important; }
        .h-48 { height: 8rem !important; }
        .text-5xl { font-size: 2.5rem !important; }
        .text-4xl { font-size: 2rem !important; }
        .text-2xl { font-size: 1.2rem !important; }
        
        /* Sidebar Styling Shared */
        #step-3 .w-\[280px\]::-webkit-scrollbar { display: none; }
        
        #step-3 .category-btn { 
            flex: 0 0 auto !important; 
            padding: 0.6rem 1.2rem !important; 
            border-radius: 1.2rem !important;
            font-size: 1rem !important;
            gap: 0.5rem !important;
        }
        #step-3 .category-btn img { width: 1.8rem !important; height: 1.8rem !important; }
        
        /* Menu Grid Shared */
        #menu-container { 
            padding: 1rem !important; 
            gap: 1rem !important; 
        }
        
        .menu-card { 
            padding: 0.8rem !important; 
            border-radius: 1.5rem !important;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .menu-card .h-60 { height: 9rem !important; border-radius: 1.2rem !important; }
        .menu-card h3 { font-size: 1.1rem !important; margin-top: 0.5rem !important; }
        .menu-card .text-red-600 { font-size: 1.2rem !important; }
        .menu-card button { padding: 0.6rem !important; font-size: 1rem !important; border-radius: 0.8rem !important; }

        /* Bottom Nav & Cart Details */
        .bottom-nav { 
            padding: 1rem 1.5rem !important; 
            min-height: 8rem !important; 
            background: white !important;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.05) !important;
            z-index: 60;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            border-top: 2px solid #f3f4f6 !important;
        }

        #cart-details { 
            background: white;
            z-index: 50;
            max-height: 70vh !important;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -20px 80px rgba(0,0,0,0.1) !important;
            border-top: 1px solid #fee2e2 !important;
        }

        #cart-items-list { 
            max-height: 40vh !important; 
            overflow-y: auto !important;
        }

        #total-price { font-size: 2rem !important; }
        #checkout-btn { height: 4rem !important; font-size: 1.4rem !important; width: 45% !important; border-radius: 1.5rem !important; }
        #cart-arrow { width: 3rem !important; height: 3rem !important; font-size: 2rem !important; }
        
        /* Modal Penyesuaian - Moved to Orientation Media Queries */
        
        /* Receipt Penyesuaian - Moved to Orientation Media Queries */
        #queue-number { font-size: 5rem !important; }

        .bg-pattern {
            background-image: radial-gradient(#f0f0f0 1.5px, transparent 1.5px);
            background-size: 30px 30px;
        }

        .btn-sederhana {
            background: linear-gradient(135deg, #cc0000 0%, #a00000 100%);
            color: white;
            box-shadow: 0 15px 35px rgba(204, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .active-step { display: flex !important; }
        .hidden-step { display: none !important; }

        .menu-card {
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .category-btn.active {
            background-color: #cc0000;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(204, 0, 0, 0.2);
        }

        .best-seller-label {
            background: #ffcc00;
            color: #856404;
            font-size: 14px;
            font-weight: 800;
            padding: 8px 20px;
            border-radius: 0 0 0 20px;
            position: absolute;
            top: 0;
            right: 0;
        }
    </style>
</head>
<body>

    <div class="kiosk-canvas bg-pattern">
        
        <section id="step-1" class="active-step w-full h-full flex-col items-center justify-center p-20 animate__animated animate__fadeIn relative">
            <button onclick="toggleFullscreen()" class="absolute top-10 left-10 w-20 h-20 bg-white/20 hover:bg-white/40 rounded-2xl flex items-center justify-center text-4xl text-gray-400 transition-all z-50">
                <i id="fs-icon-1" class="ri-fullscreen-fill"></i>
            </button>
            <div class="mb-20 animate__animated animate__pulse animate__infinite">
                <img src="https://restoransederhana.id/wp-content/uploads/2018/11/PTSA-LOGO-ADR-4.png" class="w-80">
            </div>
            <h1 class="text-4xl font-light tracking-[1em] text-gray-400 uppercase mb-32">Tradisi Rasa</h1>
            <div onclick="nextStep(2)" class="cursor-pointer group flex flex-col items-center">
                <div class="btn-sederhana w-48 h-48 rounded-full flex items-center justify-center mb-8 shadow-2xl group-active:scale-90 transition-all">
                    <span class="text-5xl">üëÜ</span>
                </div>
                <p class="text-2xl font-bold tracking-widest text-red-600 animate__animated animate__fadeInUp">SENTUH UNTUK MEMESAN</p>
            </div>
        </section>

        <section id="step-2" class="hidden-step w-full h-full flex-col items-center justify-center p-20 animate__animated animate__fadeIn">
            <h2 class="text-5xl font-black mb-24 text-gray-800">Selamat Datang!</h2>
            <div class="flex flex-col gap-12 w-full">
                <div onclick="selectOrderType('Dine In')" class="bg-white p-12 rounded-[4rem] shadow-xl border-4 border-transparent hover:border-red-600 transition-all flex items-center gap-10 active:scale-95">
                    <div class="text-9xl">üçΩÔ∏è</div>
                    <div class="text-left">
                        <h3 class="text-4xl font-black text-gray-800">Makan Di Sini</h3>
                        <p class="text-2xl text-gray-400">Nikmati suasana hangat kami</p>
                    </div>
                </div>
                <div onclick="selectOrderType('Take Away')" class="bg-white p-12 rounded-[4rem] shadow-xl border-4 border-transparent hover:border-red-600 transition-all flex items-center gap-10 active:scale-95">
                    <div class="text-9xl">üõçÔ∏è</div>
                    <div class="text-left">
                        <h3 class="text-4xl font-black text-gray-800">Bawa Pulang</h3>
                        <p class="text-2xl text-gray-400">Rasa Sederhana di mana saja</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="step-3" class="hidden-step w-full h-full flex flex-col animate__animated animate__fadeIn">
            <div class="h-32 px-12 flex justify-between items-center bg-white border-b-2">
                <div class="flex items-center gap-6 h-full">
                    <button onclick="toggleFullscreen()" class="h-[70%] aspect-square bg-gray-50 hover:bg-gray-100 rounded-2xl flex items-center justify-center text-3xl text-gray-400 transition-all">
                        <i id="fs-icon-2" class="ri-fullscreen-fill"></i>
                    </button>
                    <img src="https://restoransederhana.id/wp-content/uploads/2018/11/PTSA-LOGO-ADR-4.png" class="h-16">
                </div>
                <div class="px-8 py-3 bg-red-600 text-white rounded-full font-black text-xl" id="display-order-type">Dine In</div>
            </div>

            <div class="flex-1 flex overflow-hidden">
                <div class="w-[280px] bg-gray-50 border-r-2 p-6 flex flex-col gap-6">
                    <button onclick="filterMenu('nasi')" class="category-btn active bg-red-600 text-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Nasi Putih.webp" class="w-10 h-10 rounded-xl object-cover">Nasi
                    </button>
                    <button onclick="filterMenu('ayam')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/ayam goreng padang.webp" class="w-10 h-10 rounded-xl object-cover">Ayam
                    </button>
                    <button onclick="filterMenu('ikan')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Ikan Mas Goreng.webp" class="w-10 h-10 rounded-xl object-cover">Ikan
                    </button>
                    <button onclick="filterMenu('daging')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Rendang Daging.webp" class="w-10 h-10 rounded-xl object-cover">Daging
                    </button>
                    <button onclick="filterMenu('wedang')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Es teh.webp" class="w-10 h-10 rounded-xl object-cover">Wedang
                    </button>
                    <button onclick="filterMenu('jus')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Juice Mangga.webp" class="w-10 h-10 rounded-xl object-cover">Jus
                    </button>
                    <button onclick="filterMenu('pelengkap')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Perkedel Kentang.webp" class="w-10 h-10 rounded-xl object-cover">Pelengkap
                    </button>
                    <button id="btn-cemilan" onclick="filterMenu('cemilan')" class="category-btn bg-white p-8 rounded-[2rem] font-black text-xl text-left border-2 border-gray-100 shadow-sm transition-all flex items-center gap-4">
                        <img src="media/Roti Cane.webp" class="w-10 h-10 rounded-xl object-cover">Cemilan
                    </button>
                </div>

                <div id="menu-container" class="flex-1 p-8 grid grid-cols-2 gap-8 overflow-y-auto content-start pb-40 bg-gray-50/30">
                    </div>
            </div>

            <div class="bottom-nav flex justify-between items-center border-t-4 gap-8 relative">
                <!-- Cart Details Panel (Hidden by default) -->
                <div id="cart-details" class="absolute bottom-[320px] left-0 w-full bg-white shadow-[0_-20px_80px_rgba(0,0,0,0.15)] rounded-t-[4rem] p-12 transition-all duration-500 z-50 translate-y-full opacity-0 pointer-events-none border-t-4 border-red-50">
                    <div class="flex justify-between items-center mb-10">
                        <div class="flex items-center gap-4">
                            <div class="w-3 h-10 bg-red-600 rounded-full"></div>
                            <h3 class="text-4xl font-black text-gray-800 uppercase tracking-tight">Detail Pesanan</h3>
                        </div>
                        <button onclick="toggleCartDetails()" class="w-14 h-14 rounded-full bg-gray-50 flex items-center justify-center text-3xl text-gray-400 hover:bg-red-50 hover:text-red-600 transition-all">
                            <i class="ri-close-line"></i>
                        </button>
                    </div>
                    <div id="cart-items-list" class="max-h-[800px] overflow-y-auto space-y-6 mb-10 pr-4">
                        <!-- Items will be injected here -->
                    </div>
                    <div class="bg-gray-50 p-8 rounded-[2.5rem] flex justify-between items-center">
                        <span class="text-2xl font-bold text-gray-400 uppercase tracking-widest">Subtotal</span>
                        <span class="text-4xl font-black text-red-600" id="cart-details-total">Rp 0</span>
                    </div>
                </div>

                <div class="flex items-center flex-1 gap-6 cursor-pointer group" onclick="toggleCartDetails()">
                    <div class="flex flex-col">
                        <span class="text-2xl uppercase tracking-widest text-gray-400 font-black mb-2">Total Harga</span>
                        <div class="flex items-center gap-4">
                            <span class="text-6xl font-black text-gray-900" id="total-price">Rp 0</span>
                            <div id="cart-arrow" class="w-14 h-14 rounded-full bg-gray-100 flex items-center justify-center text-4xl text-gray-400 group-hover:bg-red-600 group-hover:text-white transition-all shadow-sm">
                                <i class="ri-arrow-up-s-line transition-transform duration-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="checkout-btn" onclick="handleCheckout()" class="btn-sederhana w-1/2 h-1/2 rounded-[2.5rem] text-2xl font-black shadow-2xl active:scale-95 flex items-center justify-center text-center leading-none">
                    BAYAR
                </button>
            </div>
        </section>

        <!-- Upsell modal removed -->

        <section id="step-4" class="hidden-step w-full h-full flex-col items-center justify-center p-20 animate__animated animate__fadeIn">
            <div class="bg-white p-20 rounded-[5rem] shadow-2xl w-full text-center border overflow-y-auto max-h-[90%]">
                <h2 class="text-5xl font-black mb-10">Pilih Metode Pembayaran</h2>
                
                <!-- Payment Method Selection Buttons -->
                <div id="payment-selection" class="grid grid-cols-2 gap-10 mb-10">
                    <button onclick="setPaymentMethod('QRIS')" id="btn-select-qris" class="flex flex-col items-center justify-center p-12 rounded-[3rem] border-4 border-gray-100 hover:border-red-600 transition-all gap-4 group">
                        <span class="text-8xl group-hover:scale-110 transition-transform">üì±</span>
                        <span class="text-3xl font-black">QRIS</span>
                    </button>
                    <button onclick="setPaymentMethod('CARD')" id="btn-select-card" class="flex flex-col items-center justify-center p-12 rounded-[3rem] border-4 border-gray-100 hover:border-red-600 transition-all gap-4 group">
                        <span class="text-8xl group-hover:scale-110 transition-transform">üí≥</span>
                        <span class="text-3xl font-black">KARTU</span>
                    </button>
                </div>

                <div class="flex flex-col gap-4 mb-8">
                    <div class="flex justify-between items-center px-4">
                        <span class="text-2xl text-gray-500 font-bold">Total Pembayaran:</span>
                        <span class="text-4xl font-black text-red-600" id="final-total">Rp 0</span>
                    </div>
                </div>

                <div class="payment-summary-wrapper">
                    <!-- QRIS Container (Hidden by default) -->
                    <div id="qris-container" class="hidden bg-gray-50 p-6 rounded-[3rem] mb-6 border-4 border-dashed border-red-100 animate__animated animate__fadeInUp">
                        <div id="qris-qr-wrapper" class="bg-white p-4 rounded-2xl shadow-xl inline-block mb-4">
                            <!-- QR Code points to payment_portal.html -->
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=payment_portal.html" id="qris-image" class="w-48 mx-auto rounded-xl">
                        </div>
                        <p class="text-xl font-bold text-gray-400 mb-2 uppercase tracking-widest">Pindai QR Untuk Membayar</p>
                        <div id="payment-timer" class="text-lg font-bold text-red-500 mb-2 hidden">Menunggu konfirmasi... (60s)</div>
                    </div>

                    <!-- Card Container (Hidden by default) -->
                    <div id="card-container" class="hidden bg-gray-50 p-6 rounded-[3rem] mb-6 border-4 border-red-100 animate__animated animate__fadeInUp">
                        <div class="grid grid-cols-2 gap-4 mb-6 text-left">
                            <div class="col-span-2">
                                <label class="block font-black text-xl mb-2 text-gray-700">Nomor Kartu</label>
                                <input id="card-number" oninput="validateCardForm()" class="w-full p-4 rounded-2xl border-2 border-gray-100 focus:border-red-600 outline-none text-2xl font-bold transition-all" placeholder="4111 1111 1111 1111" maxlength="19">
                            </div>
                            <div class="col-span-2">
                                <label class="block font-black text-xl mb-2 text-gray-700">Nama Lengkap</label>
                                <input id="card-name" oninput="validateCardForm()" class="w-full p-4 rounded-2xl border-2 border-gray-100 focus:border-red-600 outline-none text-2xl font-bold transition-all" placeholder="CONTOH NAMA">
                            </div>
                            <div>
                                <label class="block font-black text-lg mb-2 text-gray-700">MM/YY</label>
                                <input id="card-exp" oninput="validateCardForm()" class="w-full p-4 rounded-2xl border-2 border-gray-100 focus:border-red-600 outline-none text-2xl font-bold transition-all" placeholder="12/28" maxlength="5">
                            </div>
                            <div>
                                <label class="block font-black text-lg mb-2 text-gray-700">CVV</label>
                                <input id="card-cvv" oninput="validateCardForm()" class="w-full p-4 rounded-2xl border-2 border-gray-100 focus:border-red-600 outline-none text-2xl font-bold transition-all" placeholder="123" maxlength="3">
                            </div>
                        </div>
                        <button onclick="payWithCard()" id="card-pay-btn" disabled class="w-full py-6 rounded-2xl text-2xl font-black shadow-xl bg-gray-300 text-gray-500 cursor-not-allowed transition-all">BAYAR DENGAN KARTU</button>
                    </div>
                </div>

                <button onclick="nextStep(3)" class="flex items-center justify-center gap-4 bg-gray-200 text-gray-900 px-10 py-5 rounded-[2.5rem] text-2xl font-black hover:bg-gray-500 transition-all mt-10 mx-auto">
                    <span class="w-10 h-10 rounded-full border-2 border-gray-400 flex items-center justify-center">
                        <i class="ri-arrow-left-s-line"></i>
                    </span>
                    Kembali ke Menu
                </button>
            </div>
        </section>

        <section id="step-5" class="hidden-step w-full h-full flex-col items-center justify-center text-center p-20 animate__animated animate__zoomIn">
            <div class="no-print w-full flex flex-col items-center justify-center mb-10">
                <div class="w-64 h-64 bg-green-100 text-green-500 rounded-full flex items-center justify-center text-9xl mb-8 animate__animated animate__bounceIn">‚úì</div>
                <h2 class="text-6xl font-black mb-4">Berhasil!</h2>
                <p class="text-3xl text-gray-400 mb-8 font-bold leading-relaxed">Pesanan Anda sedang kami <br> siapkan dengan cinta.</p>
            </div>
            
            <div id="printable-area" class="bg-white p-12 border-4 border-gray-100 w-full max-w-[600px] mx-auto text-black text-left shadow-inner rounded-3xl">
                <!-- Momoyo Style Header -->
                <div class="logo-container">
                    <img src="https://restoransederhana.id/wp-content/uploads/2018/11/PTSA-LOGO-ADR-4.png" class="mx-auto">
                </div>
                <h1 class="uppercase">Restoran Sederhana</h1>
                <div class="outlet-info">
                    <p>CABANG GATEWAY SIDOARJO</p>
                    <p>Jl. Raya Gateway No. 1, Waru, Sidoarjo</p>
                    <p>Telp: (031) 12345678</p>
                </div>

                <!-- Order Meta -->
                <div class="order-meta">
                    <div>
                        <span>Order Number:</span>
                        <span id="receipt-order-id">202601210001</span>
                    </div>
                    <div>
                        <span>Print Time:</span>
                        <span id="receipt-date-top">21-01-2026 18:00</span>
                    </div>
                    <div>
                        <span>Cashier:</span>
                        <span>Kiosk-Self</span>
                    </div>
                    <div>
                        <span>Sale Channel:</span>
                        <span id="receipt-order-type">Dine In</span>
                    </div>
                </div>

                <!-- Queue Number (Main Focus like Momoyo) -->
                <div class="queue-section">
                    <div class="queue-label">Nomor Antrean</div>
                    <h3 id="queue-number">A-000</h3>
                </div>

                <!-- Product List Header -->
                <div class="flex justify-between border-b border-dashed border-black pb-1 mb-2 text-xs font-bold uppercase">
                    <span>Product Name</span>
                    <div class="flex gap-4">
                        <span>Qty</span>
                        <span>Total</span>
                    </div>
                </div>

                <!-- Items List -->
                <div id="receipt-items" class="space-y-2">
                    <!-- Items will be injected here -->
                </div>

                <!-- Payment Summary -->
                <div class="total-section">
                    <div class="total-row">
                        <span>Total Amount:</span>
                        <span id="receipt-subtotal">Rp 0</span>
                    </div>
                    <div class="total-row">
                        <span>Payment Method:</span>
                        <span id="receipt-method">QRIS</span>
                    </div>
                    <div class="total-row total-amount">
                        <span>Payable Amount:</span>
                        <span id="receipt-total">Rp 0</span>
                    </div>
                </div>

                <!-- Sweet Footer Message -->
                <div class="footer-msg">
                    <p>Uni & Uda terlihat sangat serasi hari ini!</p>
                    <p>Terima kasih telah berbagi momen manis di Sederhana.</p>
                    <p>Rasa Sederhana, Kenangan Istimewa. ‚ú®</p>
                </div>
            </div>

            <div class="flex gap-6 mt-12 no-print">
                <button onclick="window.print()" class="btn-sederhana px-16 py-6 rounded-full text-2xl font-black shadow-xl flex items-center gap-4">
                    <span>üñ®Ô∏è</span> CETAK RESI
                </button>
                <button onclick="location.reload()" class="bg-gray-200 text-gray-500 px-16 py-6 rounded-full text-2xl font-black hover:bg-gray-300">
                    SELESAI
                </button>
            </div>
        </section>

    </div>

    <script>
        const menuItems = [
            { id: 1, category: 'nasi', name: 'Nasi Putih', price: 4000, img: 'media/Nasi Putih.webp', isBestSeller: true },
            { id: 2, category: 'nasi', name: 'Nasi Merah', price: 6000, img: 'media/Nasi Merah.webp' },
            { id: 3, category: 'nasi', name: 'Nasi Kuning', price: 6000, img: 'media/Nasi Kuning.webp' },
            { id: 4, category: 'nasi', name: 'Nasi Jagung', price: 7000, img: 'media/Nasi Jagung.webp' },
            { id: 5, category: 'nasi', name: 'Paket Naspad 1', price: 25000, img: 'media/Paket Naspad 1(nasi lauk ayam serundeng Rendang Sambel Ijo).webp', isBestSeller: true },
            { id: 6, category: 'nasi', name: 'Paket Naspad 2', price: 28000, img: 'media/Paket Naspad 2(lauk dendeng daging, gulai tunjang, sayur nangka sambel ijo).webp' },
            { id: 7, category: 'nasi', name: 'Paket Naspad 3', price: 25000, img: 'media/Paket Naspad 3(lauk rendang, telur opor, sayur nangka sambel ijo).webp' },
            { id: 8, category: 'nasi', name: 'Paket Naspad 4', price: 22000, img: 'media/Paket Naspad 4(lauk ayam goreng, telor dadar, perkedel sambel merah).webp' },

            { id: 10, category: 'daging', name: 'Rendang Daging', price: 22000, img: 'media/Rendang Daging.webp', isBestSeller: true },
            { id: 11, category: 'daging', name: 'Dendeng Batokok', price: 18000, img: 'media/Dendeng Batokok.webp' },
            { id: 12, category: 'daging', name: 'Dendeng Balado', price: 19000, img: 'media/Dendeng Balado.webp' },
            { id: 13, category: 'daging', name: 'Paru Goreng', price: 15000, img: 'media/Paru Goreng.webp' },
            { id: 14, category: 'daging', name: 'Sate Padang', price: 25000, img: 'media/Sate Padang.webp', isBestSeller: true },
            { id: 15, category: 'daging', name: 'Sop Iga Sapi', price: 30000, img: 'media/Sop Iga Sapi.webp' },
            { id: 16, category: 'daging', name: 'Gulai Cincang Kambing', price: 32000, img: 'media/Gulai Cincang Kambing.webp' },
            { id: 17, category: 'daging', name: 'Gulai Tunjang', price: 28000, img: 'media/Gulai Tunjang.webp', isBestSeller: true },
            { id: 18, category: 'daging', name: 'Gulai Babat', price: 27000, img: 'media/Gulai Babat.webp' },
            { id: 19, category: 'daging', name: 'Gulai Otak', price: 26000, img: 'media/Gulai Otak.webp' },
            { id: 20, category: 'daging', name: 'Gulai Usus', price: 24000, img: 'media/Gulai Usus.webp' },

            { id: 30, category: 'ayam', name: 'Ayam Bakar Padang', price: 22000, img: 'media/ayam bakar padang.webp' },
            { id: 31, category: 'ayam', name: 'Ayam Goreng Padang', price: 16000, img: 'media/ayam goreng padang.webp' },
            { id: 32, category: 'ayam', name: 'Ayam Gulai Padang', price: 17000, img: 'media/ayam gulai padang.webp' },
            { id: 33, category: 'ayam', name: 'Ayam Pop Padang', price: 18000, img: 'media/ayam pop padang.webp', isBestSeller: true },

            { id: 40, category: 'ikan', name: 'Ikan Mas Goreng', price: 25000, img: 'media/Ikan Mas Goreng.webp' },
            { id: 41, category: 'ikan', name: 'Ikan Kembung Bakar', price: 20000, img: 'media/Ikan Kembung Bakar.webp' },
            { id: 42, category: 'ikan', name: 'Ikan Bawal Bakar', price: 35000, img: 'media/Ikan Bawal Bakar.webp' },
            { id: 43, category: 'ikan', name: 'Ikan Nila Bakar', price: 28000, img: 'media/Ikan Nila Bakar.webp' },
            { id: 44, category: 'ikan', name: 'Ikan Asin Gabus Cabe Hijau', price: 32000, img: 'media/Ikan Asin Gabus Cabe Hijau.webp' },
            { id: 45, category: 'ikan', name: 'Ikan Sepat Cabe Hijau', price: 22000, img: 'media/Ikan Sepat Cabe Hijau.webp' },
            { id: 46, category: 'ikan', name: 'Gulai Ikan Mas', price: 28000, img: 'media/Gulai Ikan Mas.webp' },
            { id: 47, category: 'ikan', name: 'Gulai Ikan Tenggiri', price: 25000, img: 'media/Gulai Ikan Tenggiri.webp' },
            { id: 48, category: 'ikan', name: 'Gulai Kepala Kakap', price: 37000, img: 'media/Gulai Kepala Kakap.webp' },
            { id: 49, category: 'ikan', name: 'Gulai Kakap', price: 40000, img: 'media/gulai-kakap-640x640.webp' },
            { id: 50, category: 'ikan', name: 'Gulai Cumi', price: 35000, img: 'media/Gulai Cumi.webp' },
            { id: 51, category: 'ikan', name: 'Ikan Kembung Rica', price: 27000, img: 'media/Ikan-Kembung-Rica-640x640.webp' },

            { id: 60, category: 'wedang', name: 'Es Teh', price: 6000, img: 'media/Es teh.webp', isBestSeller: true },
            { id: 61, category: 'wedang', name: 'Teh Hangat', price: 5000, img: 'media/Teh Hangat.webp' },
            { id: 62, category: 'wedang', name: 'Teh Talua', price: 18000, img: 'media/Teh Talua.webp' },
            { id: 63, category: 'wedang', name: 'Kopi Hangat', price: 13000, img: 'media/Kopi hangat.webp' },
            { id: 64, category: 'wedang', name: 'Kopi Kawa Daun', price: 20000, img: 'media/Kopi kawa daun.webp' },
            { id: 65, category: 'pelengkap', name: 'Soto Padang', price: 18000, img: 'media/Soto Padang.webp' },
            { id: 66, category: 'wedang', name: 'Es Tebak', price: 15000, img: 'media/Es Tebak.webp' },

            { id: 80, category: 'jus', name: 'Jus Mangga', price: 11000, img: 'media/Juice Mangga.webp', isBestSeller: true },
            { id: 81, category: 'jus', name: 'Jus Alpukat', price: 15000, img: 'media/Juice Alpukat.webp' },
            { id: 82, category: 'jus', name: 'Jus Jeruk', price: 12000, img: 'media/Juice Jeruk.webp' },
            { id: 83, category: 'jus', name: 'Jus Jambu', price: 14000, img: 'media/Juice Jambu.webp' },
            { id: 84, category: 'jus', name: 'Jus Melon', price: 14000, img: 'media/Juice Melon.webp' },
            { id: 85, category: 'jus', name: 'Jus Pepaya', price: 14000, img: 'media/Juice Pepaya.webp' },
            { id: 86, category: 'jus', name: 'Jus Sirsak', price: 15000, img: 'media/Juice Sirsak.webp' },
            { id: 87, category: 'jus', name: 'Jus Wortel', price: 14000, img: 'media/Juice Wortel.webp' },
            { id: 88, category: 'jus', name: 'Jus Tomat', price: 14000, img: 'media/Juice Tomat.webp' },
            { id: 89, category: 'jus', name: 'Jus Apel', price: 18000, img: 'media/Juice Apel.webp' },
            { id: 90, category: 'jus', name: 'Jus Buah Naga', price: 15000, img: 'media/Juice Buah Naga.webp' },
            { id: 91, category: 'jus', name: 'Jus Terong Belanda', price: 16000, img: 'media/Juice Terong Belanda.webp' },
            { id: 92, category: 'jus', name: 'Jus Kedondong', price: 17000, img: 'media/Juice Kedondong.webp' },
            { id: 93, category: 'jus', name: 'Jus Timun', price: 14000, img: 'media/Juice Timun.webp' },
            { id: 94, category: 'jus', name: 'Jus Durian', price: 19000, img: 'media/Juice Durian.webp' },
            { id: 95, category: 'jus', name: 'Jus Kopyor', price: 19000, img: 'media/Juice Kopyor.webp' },
            { id: 96, category: 'jus', name: 'Jus Apel Mix', price: 17000, img: 'media/jus mix.webp' },
            { id: 97, category: 'jus', name: 'Jus Pukat Naga Sirsak', price: 20000, img: 'media/jus pukat naga sirsak.webp' },
            { id: 98, category: 'jus', name: 'Jus Belimbing', price: 12000, img: 'media/Juice Belimbing.webp' },

            { id: 100, category: 'pelengkap', name: 'Perkedel Kentang', price: 8000, img: 'media/Perkedel Kentang.webp' },
            { id: 101, category: 'pelengkap', name: 'Telor Dadar', price: 9000, img: 'media/Telor Dadar.webp', isBestSeller: true },
            { id: 102, category: 'pelengkap', name: 'Sayur Nangka', price: 5000, img: 'media/Sayur nangka.webp' },
            { id: 103, category: 'pelengkap', name: 'Sayur Daun Singkong', price: 5000, img: 'media/Sayur daun singkong teri.webp' },
            { id: 104, category: 'pelengkap', name: 'Peyek Udang', price: 11000, img: 'media/Peyek Udang.webp' },
            { id: 105, category: 'daging', name: 'Martabak Mesir', price: 18000, img: 'media/Martabak mesir.webp' },

            { id: 201, category: 'cemilan', name: 'Roti Cane', price: 12000, img: 'media/Roti Cane.webp' },
            { id: 202, category: 'cemilan', name: 'Krupuk Kulit', price: 9000, img: 'media/Krupuk Kulit.webp' },
            { id: 203, category: 'cemilan', name: 'Kue Lumpur', price: 9000, img: 'media/Kue Lumpur.webp' },
            { id: 204, category: 'cemilan', name: 'Kue Sampik', price: 9000, img: 'media/Kue Sampik.webp' },
            { id: 205, category: 'cemilan', name: 'Lamang Tapai', price: 12000, img: 'media/Lamang Tapai.webp' },
            { id: 206, category: 'cemilan', name: 'Lapek Sagan', price: 12000, img: 'media/Lapek Sagan.webp' },
            { id: 207, category: 'cemilan', name: 'Bubur Kampiun', price: 15000, img: 'media/Bubur Kampiun.webp' },
            { id: 208, category: 'cemilan', name: 'Cireng', price: 11000, img: 'media/Cireng.webp' },
            { id: 209, category: 'cemilan', name: 'Cireng Kuah', price: 12000, img: 'media/Cireng Kuah.webp' },
        ];

        let state = { total: 0, cart: [], currentCategory: 'nasi' };

        function nextStep(step) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-step'));
            document.getElementById(`step-${step}`).classList.remove('hidden-step');
            document.getElementById(`step-${step}`).classList.add('active-step');
            
            // Reset sidebar visibility if returning to menu
            if (step === 3) {
                const sidebar = document.querySelector('.w-\\[280px\\]');
                if (sidebar) sidebar.classList.remove('hidden');
            }

            if(step === 4) {
                document.getElementById('final-total').innerText = formatIDR(state.total);
                // Reset payment selection UI when entering payment step
                document.getElementById('payment-selection').classList.remove('hidden');
                document.getElementById('qris-container').classList.add('hidden');
                document.getElementById('card-container').classList.add('hidden');
            }
        }

        function selectOrderType(type) {
            document.getElementById('display-order-type').innerText = type;
            nextStep(3);
            filterMenu('nasi');
        }

        function formatIDR(val) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(val);
        }

        function renderMenu(filter = 'all') {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';
            
            // Tambahkan Pesan Manis untuk Cemilan
            if (filter === 'cemilan') {
                const promoDiv = document.createElement('div');
                // Menggunakan col-span-full agar memenuhi seluruh lebar grid
                promoDiv.className = 'col-span-full bg-gradient-to-r from-red-50 to-orange-50 p-10 rounded-[3rem] border-2 border-red-100 mb-8 animate__animated animate__fadeInDown flex gap-6 items-start w-full';
                promoDiv.innerHTML = `
                    <button onclick="filterMenu('nasi')" class="mt-1 w-12 h-12 rounded-full border-2 border-gray-600 flex items-center justify-center flex-shrink-0 hover:bg-white transition-all active:scale-90">
                        <i class="ri-arrow-left-s-line text-black text-2xl"></i>
                    </button>
                    <div>
                        <h3 class="text-3xl font-black text-red-600 mb-2">Penutup yang Sempurna untuk Uni & Uda! ‚ú®</h3>
                        <p class="text-xl text-gray-600 font-medium">Uni & Uda terlihat sangat serasi dengan pilihan menu utamanya. Bagaimana kalau ditambah cemilan manis atau gurih kami? Pasti akan melengkapi kebahagiaan makan hari ini!</p>
                    </div>
                `;
                container.appendChild(promoDiv);
            }

            const items = filter === 'all' ? menuItems : menuItems.filter(i => i.category === filter);

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'menu-card relative bg-white p-8 rounded-[3rem] shadow-lg border-2 border-transparent active:border-red-600 transition-all active:scale-95';
                div.innerHTML = `
                    ${item.isBestSeller ? '<div class="best-seller-label">TERLARIS</div>' : ''}
                    <div class="h-60 flex items-center justify-center bg-gray-50 rounded-[2.5rem] mb-6 overflow-hidden">
                        <img src="${item.img}" alt="${item.name}" class="w-full h-full object-cover rounded-[2.5rem]">
                    </div>
                    <div>
                        <h4 class="text-2xl font-black text-gray-800 mb-2 leading-tight">${item.name}</h4>
                        <p class="text-3xl font-black text-red-600 mb-6">${formatIDR(item.price)}</p>
                        <button onclick="addToCart(${item.id})" class="w-full py-5 bg-gray-100 rounded-2xl font-black text-xl text-gray-400 active:bg-red-600 active:text-white uppercase">Tambah</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function addToCart(id) {
            const item = menuItems.find(i => i.id === id);
            state.total += item.price;
            state.cart.push({ id: item.id, name: item.name, price: item.price, img: item.img, category: item.category });
            document.getElementById('total-price').innerText = formatIDR(state.total);
            
            // Animasi Feedback
            document.getElementById('total-price').classList.add('animate__animated', 'animate__rubberBand');
            setTimeout(() => document.getElementById('total-price').classList.remove('animate__animated', 'animate__rubberBand'), 1000);

            // Update details list if open
            if (!document.getElementById('cart-details').classList.contains('translate-y-full')) {
                updateCartItemsList();
            }
        }

        function toggleCartDetails() {
            const panel = document.getElementById('cart-details');
            const arrow = document.querySelector('#cart-arrow i');
            const isHidden = panel.classList.contains('translate-y-full');

            if (isHidden) {
                panel.classList.remove('translate-y-full', 'opacity-0', 'pointer-events-none');
                arrow.classList.add('rotate-180');
                updateCartItemsList();
            } else {
                panel.classList.add('translate-y-full', 'opacity-0', 'pointer-events-none');
                arrow.classList.remove('rotate-180');
            }
        }

        function updateCartItemsList() {
            const list = document.getElementById('cart-items-list');
            const totalDisplay = document.getElementById('cart-details-total');
            list.innerHTML = '';

            if (state.cart.length === 0) {
                list.innerHTML = '<div class="text-center py-20 text-gray-300 text-3xl font-bold">Keranjang Anda kosong</div>';
                totalDisplay.innerText = formatIDR(0);
                return;
            }

            // Group items by ID
            const grouped = state.cart.reduce((acc, item) => {
                if (!acc[item.id]) {
                    acc[item.id] = { ...item, quantity: 0 };
                }
                acc[item.id].quantity++;
                return acc;
            }, {});

            Object.values(grouped).forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between bg-white p-6 rounded-[2.5rem] border-2 border-gray-100 shadow-sm animate__animated animate__fadeInUp';
                div.innerHTML = `
                    <div class="flex items-center gap-6">
                        <div class="w-24 h-24 rounded-3xl overflow-hidden bg-gray-50 border-2 border-gray-100">
                            <img src="${item.img}" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h4 class="text-2xl font-black text-gray-800 leading-tight">${item.name}</h4>
                            <p class="text-xl font-bold text-red-600">${formatIDR(item.price)}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6 bg-gray-50 p-3 rounded-full border-2 border-gray-100 shadow-inner">
                        <button onclick="updateCartItem(${item.id}, -1)" class="w-14 h-14 rounded-full bg-white flex items-center justify-center text-4xl font-black text-gray-400 hover:text-red-600 shadow-md transition-all active:scale-90">-</button>
                        <span class="text-3xl font-black text-gray-800 w-10 text-center">${item.quantity}</span>
                        <button onclick="updateCartItem(${item.id}, 1)" class="w-14 h-14 rounded-full bg-red-600 flex items-center justify-center text-4xl font-black text-white hover:bg-red-700 shadow-lg transition-all active:scale-90">+</button>
                    </div>
                `;
                list.appendChild(div);
            });

            totalDisplay.innerText = formatIDR(state.total);
        }

        function updateCartItem(id, change) {
            if (change > 0) {
                const item = menuItems.find(i => i.id === id);
                state.cart.push({ ...item });
                state.total += item.price;
            } else {
                const index = state.cart.findLastIndex(i => i.id === id);
                if (index !== -1) {
                    state.total -= state.cart[index].price;
                    state.cart.splice(index, 1);
                }
            }

            document.getElementById('total-price').innerText = formatIDR(state.total);
            updateCartItemsList();

            if (state.total === 0) {
                const panel = document.getElementById('cart-details');
                if (!panel.classList.contains('translate-y-full')) toggleCartDetails();
            }
        }

        function handleCheckout() {
            if (state.total === 0) return alert("Pilih menu dulu!");
            
            // Tutup rincian pesanan jika sedang terbuka
            const panel = document.getElementById('cart-details');
            if (!panel.classList.contains('translate-y-full')) {
                toggleCartDetails();
            }

            if (state.currentCategory !== 'cemilan') {
                // Otomatis pindah ke kategori Cemilan sebelum bayar
                filterMenu('cemilan');
                // Ubah teks tombol untuk langkah selanjutnya
                document.getElementById('checkout-btn').innerText = 'BAYAR SEKARANG';
            } else {
                nextStep(4);
            }
        }

        function filterMenu(cat) {
            state.currentCategory = cat;
            renderMenu(cat);
            
            // Auto scroll ke atas saat ganti kategori
            const container = document.getElementById('menu-container');
            if (container) {
                container.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
            // Sidebar Toggling Logic
            const sidebar = document.querySelector('.w-\\[280px\\]');
            if (cat === 'cemilan') {
                sidebar.classList.add('hidden');
                // Tambahkan tombol "Tidak Terima Kasih" di akhir menu
                const container = document.getElementById('menu-container');
                const skipDiv = document.createElement('div');
                skipDiv.className = 'col-span-2 mt-10 mb-20';
                skipDiv.innerHTML = `
                    <button onclick="nextStep(4)" class="w-full py-8 rounded-[2rem] bg-gray-100 text-gray-400 font-black text-2xl hover:bg-gray-200 transition-all border-2 border-dashed border-gray-300 active:scale-95">
                        Tidak terimakasih, saya tidak ingin tambahan menu
                    </button>
                `;
                container.appendChild(skipDiv);
            } else {
                sidebar.classList.remove('hidden');
            }

            // Update UI Sidebar
            document.querySelectorAll('.category-btn').forEach(b => {
                b.classList.remove('active', 'bg-red-600', 'text-white');
                b.classList.add('bg-white');
            });

            // Cari tombol yang diklik atau yang sesuai kategori
            const btn = (event && (event.currentTarget || event.target)) || [...document.querySelectorAll('.category-btn')].find(b => b.onclick.toString().includes(`'${cat}'`));
            
            if (btn) btn.classList.add('active', 'bg-red-600', 'text-white');

            // Reset teks tombol bayar jika bukan di kategori cemilan
            const checkoutBtn = document.getElementById('checkout-btn');
            if (cat === 'cemilan') {
                checkoutBtn.innerText = 'BAYAR SEKARANG';
            } else {
                checkoutBtn.innerText = 'BAYAR';
            }
        }

        let paymentCheckInterval;
        let ntfyAbortController;

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        document.addEventListener('fullscreenchange', () => {
            const icons = ['fs-icon-1', 'fs-icon-2'];
            icons.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (document.fullscreenElement) {
                        el.classList.remove('ri-fullscreen-fill');
                        el.classList.add('ri-fullscreen-exit-fill');
                    } else {
                        el.classList.remove('ri-fullscreen-exit-fill');
                        el.classList.add('ri-fullscreen-fill');
                    }
                }
            });
        });

        function setPaymentMethod(method) {
            state.paymentMethod = method;
            document.getElementById('final-total').innerText = formatIDR(state.total);
            
            // Hide selection screen, show specific method
            document.getElementById('payment-selection').classList.add('hidden');
            document.getElementById('qris-container').classList.toggle('hidden', method !== 'QRIS');
            document.getElementById('card-container').classList.toggle('hidden', method !== 'CARD');

            // Logic tambahan untuk mobile agar ringkas
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                const headerH2 = document.querySelector('#step-4 h2');
                if (headerH2) headerH2.innerText = method === 'QRIS' ? 'Pembayaran QRIS' : 'Pembayaran Kartu';
            }

            // Reset payment status in localStorage for new session
            localStorage.removeItem('sederhana_payment_status');

            // Simulasi Pembayaran Otomatis untuk QRIS
            if (method === 'QRIS') {
                const qrisText = document.querySelector('#qris-container p');
                const timerEl = document.getElementById('payment-timer');
                qrisText.innerHTML = '<span class="animate__animated animate__flash animate__infinite text-red-600">MENUNGGU PEMBAYARAN...</span>';
                
                timerEl.classList.remove('hidden');
                let timeLeft = 60;
                
                // Generate Unique Session for Cross-Device Sync
                const sessionId = Math.random().toString(36).substr(2, 9);
                
                // Update QR Code with sessionId
                const qrImg = document.getElementById('qris-image');
                const portalUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1) + 'payment_portal.html?sid=' + sessionId;
                qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(portalUrl)}`;

                // Clear any existing interval and abort controller
                if (paymentCheckInterval) clearInterval(paymentCheckInterval);
                if (ntfyAbortController) ntfyAbortController.abort();
                ntfyAbortController = new AbortController();

                // Polling/Listening to ntfy.sh for cross-device confirmation
                const checkNtfy = async () => {
                    try {
                        const response = await fetch(`https://ntfy.sh/sederhana_payment_${sessionId}/json?poll=1`, {
                            signal: ntfyAbortController.signal
                        });
                        const data = await response.json();
                        if (data && data.length > 0) {
                            // Check if any message contains 'completed'
                            const isCompleted = data.some(msg => msg.message === 'completed');
                            if (isCompleted) {
                                clearInterval(paymentCheckInterval);
                                finalizeOrder('QRIS');
                            }
                        }
                    } catch (e) {
                        if (e.name !== 'AbortError') console.error("Ntfy error:", e);
                    }
                };

                paymentCheckInterval = setInterval(() => {
                    timeLeft--;
                    timerEl.innerText = `Menunggu konfirmasi... (${timeLeft}s)`;

                    // Still check localStorage for same-device fallback
                    if (localStorage.getItem('sederhana_payment_status') === 'completed') {
                        clearInterval(paymentCheckInterval);
                        if (ntfyAbortController) ntfyAbortController.abort();
                        finalizeOrder('QRIS');
                        localStorage.removeItem('sederhana_payment_status');
                    } else {
                        // Check ntfy for cross-device
                        checkNtfy();
                    }

                    if (timeLeft <= 0) {
                        clearInterval(paymentCheckInterval);
                        if (ntfyAbortController) ntfyAbortController.abort();
                        alert("Waktu pembayaran habis. Silakan coba lagi.");
                        setPaymentMethod(null); // Reset
                        document.getElementById('payment-selection').classList.remove('hidden');
                        document.getElementById('qris-container').classList.add('hidden');
                    }
                }, 2000); // Check every 2 seconds
            } else {
                if (paymentCheckInterval) clearInterval(paymentCheckInterval);
            }

            // Reset card form if switching
            if (method === 'CARD') validateCardForm();
        }

        function validateCardForm() {
            const num = document.getElementById('card-number').value.trim();
            const name = document.getElementById('card-name').value.trim();
            const exp = document.getElementById('card-exp').value.trim();
            const cvv = document.getElementById('card-cvv').value.trim();
            const btn = document.getElementById('card-pay-btn');
            const error = document.getElementById('card-error');

            if (num && name && exp && cvv) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.add('btn-sederhana');
                error.classList.add('hidden');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                btn.classList.remove('btn-sederhana');
                error.classList.remove('hidden');
            }
        }

        function payWithCard() {
            const btn = document.getElementById('card-pay-btn');
            btn.innerHTML = '<span class="animate__animated animate__flash animate__infinite">MEMPROSES...</span>';
            setTimeout(() => finalizeOrder('CARD'), 2500);
        }

        function finalizeOrder(method) {
            state.paymentMethod = method;
            const q = generateQueueNumber();
            state.queue = q;
            document.getElementById('queue-number').innerText = q;
            
            // Set Order Meta Info
            const now = new Date();
            const orderId = now.getFullYear().toString() + 
                            (now.getMonth() + 1).toString().padStart(2, '0') + 
                            now.getDate().toString().padStart(2, '0') + 
                            Math.floor(1000 + Math.random() * 9000);
            
            const timeStr = now.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' }) + ' ' + 
                            now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            document.getElementById('receipt-order-id').innerText = orderId;
            document.getElementById('receipt-date-top').innerText = timeStr;
            document.getElementById('receipt-order-type').innerText = document.getElementById('display-order-type').innerText;
            
            // Render Items for Receipt (Grouped)
            const itemsWrap = document.getElementById('receipt-items');
            itemsWrap.innerHTML = '';
            
            const groupedReceipt = state.cart.reduce((acc, item) => {
                if (!acc[item.id]) {
                    acc[item.id] = { ...item, qty: 0 };
                }
                acc[item.id].qty++;
                return acc;
            }, {});

            Object.values(groupedReceipt).forEach(ci => {
                 const row = document.createElement('div');
                 row.className = 'item-row';
                 
                 row.innerHTML = `
                    <div class="item-main">
                        <span>${ci.name}</span>
                        <div class="flex gap-4">
                            <span>${ci.qty}</span>
                            <span>${formatIDR(ci.price * ci.qty)}</span>
                        </div>
                    </div>
                    ${ci.qty > 1 ? `<div class="item-sub"><span>@ ${formatIDR(ci.price)}</span></div>` : ''}
                 `;
                 itemsWrap.appendChild(row);
             });

            document.getElementById('receipt-subtotal').innerText = formatIDR(state.total);
            document.getElementById('receipt-method').innerText = method;
            document.getElementById('receipt-total').innerText = formatIDR(state.total);
            
            nextStep(5);
        }

        function generateQueueNumber() {
            const base = Math.floor(Date.now() / 1000) % 900 + 100;
            return `A-${base}`;
        }

        function printReceipt() {
            window.print();
        }

        renderMenu();
    </script>
</body>
</html>
